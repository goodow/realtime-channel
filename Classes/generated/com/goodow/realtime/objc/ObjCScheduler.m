//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/retechretech/dev/workspace/realtime/realtime-channel/src/main/java/com/goodow/realtime/objc/ObjCScheduler.java
//
//  Created by retechretech.
//

#include "com/goodow/realtime/core/Handler.h"
#include "com/goodow/realtime/json/Json.h"
#include "com/goodow/realtime/json/JsonObject.h"
#include "com/goodow/realtime/objc/ObjCScheduler.h"
#include "java/util/concurrent/atomic/AtomicInteger.h"
#import "GDChannel.h"

@implementation ComGoodowRealtimeObjcObjCScheduler

+ (void)nativeCancelTimerWithId:(id)timer {
  [(NSTimer *)timer invalidate];
}

+ (void)nativeHandleWithId:(id)handler
                    withId:(id)event {
  GDCBlock block = (GDCBlock)handler;
  block(event);
}

+ (id)nativeScheduleTimerWithInt:(int)delayMs
                     withBoolean:(BOOL)repeat
withComGoodowRealtimeCoreHandler:(id<ComGoodowRealtimeCoreHandler>)handler {
  return
  [NSTimer scheduledTimerWithTimeInterval:delayMs/1000
  target:handler
  selector:@selector(handleWithId:)
  userInfo:nil
  repeats:repeat];
}

- (BOOL)cancelTimerWithInt:(int)id_ {
  NSString *key = [NSString stringWithFormat:@"%d", id_];
  if ([((id<GDJsonObject>) nil_chk(timers_)) has:key]) {
    [ComGoodowRealtimeObjcObjCScheduler nativeCancelTimerWithId:[timers_ getWithNSString:key]];
    (void) [timers_ remove:key];
    return YES;
  }
  return NO;
}

- (void)handleWithId:(id)handler
              withId:(id)event {
  if ([handler conformsToProtocol: @protocol(ComGoodowRealtimeCoreHandler)]) {
    [((id<ComGoodowRealtimeCoreHandler>) nil_chk(((id<ComGoodowRealtimeCoreHandler>) check_protocol_cast(handler, @protocol(ComGoodowRealtimeCoreHandler))))) handleWithId:event];
  }
  else {
    [ComGoodowRealtimeObjcObjCScheduler nativeHandleWithId:handler withId:event];
  }
}

- (void)scheduleDeferredWithComGoodowRealtimeCoreHandler:(id<ComGoodowRealtimeCoreHandler>)handler {
  [[NSRunLoop mainRunLoop] performSelector:@selector(handleWithId:) target:handler argument:nil order:0 modes:@[NSDefaultRunLoopMode]];
}

- (int)scheduleDelayWithInt:(int)delayMs
withComGoodowRealtimeCoreHandler:(id<ComGoodowRealtimeCoreHandler>)handler {
  int id_ = [((JavaUtilConcurrentAtomicAtomicInteger *) nil_chk(timerId_)) getAndIncrement];
  (void) [((id<GDJsonObject>) nil_chk(timers_)) set:[NSString stringWithFormat:@"%d", id_] value:[ComGoodowRealtimeObjcObjCScheduler nativeScheduleTimerWithInt:delayMs withBoolean:NO withComGoodowRealtimeCoreHandler:handler]];
  return id_;
}

- (int)schedulePeriodicWithInt:(int)delayMs
withComGoodowRealtimeCoreHandler:(id<ComGoodowRealtimeCoreHandler>)handler {
  int id_ = [((JavaUtilConcurrentAtomicAtomicInteger *) nil_chk(timerId_)) getAndIncrement];
  (void) [((id<GDJsonObject>) nil_chk(timers_)) set:[NSString stringWithFormat:@"%d", id_] value:[ComGoodowRealtimeObjcObjCScheduler nativeScheduleTimerWithInt:delayMs withBoolean:YES withComGoodowRealtimeCoreHandler:handler]];
  return id_;
}

- (id)init {
  if (self = [super init]) {
    timerId_ = [[JavaUtilConcurrentAtomicAtomicInteger alloc] initWithInt:0];
    timers_ = [GDJson createObject];
  }
  return self;
}

- (void)copyAllFieldsTo:(ComGoodowRealtimeObjcObjCScheduler *)other {
  [super copyAllFieldsTo:other];
  other->timerId_ = timerId_;
  other->timers_ = timers_;
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "nativeCancelTimerWithId:", "nativeCancelTimer", "V", 0x10a, NULL },
    { "nativeHandleWithId:withId:", "nativeHandle", "V", 0x10a, NULL },
    { "nativeScheduleTimerWithInt:withBoolean:withComGoodowRealtimeCoreHandler:", "nativeScheduleTimer", "Ljava.lang.Object;", 0x10a, NULL },
    { "cancelTimerWithInt:", "cancelTimer", "Z", 0x1, NULL },
    { "handleWithId:withId:", "handle", "V", 0x1, NULL },
    { "scheduleDeferredWithComGoodowRealtimeCoreHandler:", "scheduleDeferred", "V", 0x101, NULL },
    { "scheduleDelayWithInt:withComGoodowRealtimeCoreHandler:", "scheduleDelay", "I", 0x1, NULL },
    { "schedulePeriodicWithInt:withComGoodowRealtimeCoreHandler:", "schedulePeriodic", "I", 0x1, NULL },
    { "init", NULL, NULL, 0x0, NULL },
  };
  static J2ObjcFieldInfo fields[] = {
    { "timerId_", NULL, 0x12, "Ljava.util.concurrent.atomic.AtomicInteger;" },
    { "timers_", NULL, 0x12, "Lcom.goodow.realtime.json.JsonObject;" },
  };
  static J2ObjcClassInfo _ComGoodowRealtimeObjcObjCScheduler = { "ObjCScheduler", "com.goodow.realtime.objc", NULL, 0x0, 9, methods, 2, fields, 0, NULL};
  return &_ComGoodowRealtimeObjcObjCScheduler;
}

@end
