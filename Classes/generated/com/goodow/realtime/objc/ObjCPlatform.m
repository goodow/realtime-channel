//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/retechretech/dev/workspace/realtime/realtime-channel/src/main/java/com/goodow/realtime/objc/ObjCPlatform.java
//
//  Created by retechretech.
//

#include "com/goodow/realtime/core/Handler.h"
#include "com/goodow/realtime/core/Net.h"
#include "com/goodow/realtime/core/Platform.h"
#include "com/goodow/realtime/json/Json.h"
#include "com/goodow/realtime/json/JsonObject.h"
#include "com/goodow/realtime/objc/ObjCNet.h"
#include "com/goodow/realtime/objc/ObjCPlatform.h"
#include "java/util/concurrent/atomic/AtomicInteger.h"
#import "GDChannel.h"

@implementation ComGoodowRealtimeObjcObjCPlatform

+ (void)register__ {
  [ComGoodowRealtimeCorePlatform setFactoryWithComGoodowRealtimeCorePlatformFactory:[[ComGoodowRealtimeObjcObjCPlatform alloc] init]];
}

+ (void)load {
  [ComGoodowRealtimeObjcObjCPlatform register__];
}

+ (void)nativeHandleWithId:(id)handler
                    withId:(id)event {
  GDCBlock block = (GDCBlock)handler;
  block(event);
}

- (BOOL)cancelTimerWithInt:(int)id_ {
  if ([((id<GDJsonObject>) nil_chk(timers_)) has:[NSString stringWithFormat:@"%d", id_]]) {
    [self cancelTimerWithId:[timers_ getWithNSString:[NSString stringWithFormat:@"%d", id_]]];
    (void) [timers_ remove:[NSString stringWithFormat:@"%d", id_]];
    return YES;
  }
  return NO;
}

- (void)handleWithId:(id)handler
              withId:(id)event {
  if ([handler conformsToProtocol: @protocol(ComGoodowRealtimeCoreHandler)]) {
    [((id<ComGoodowRealtimeCoreHandler>) check_protocol_cast(handler, @protocol(ComGoodowRealtimeCoreHandler))) handleWithId:event];
  }
  else {
    [ComGoodowRealtimeObjcObjCPlatform nativeHandleWithId:handler withId:event];
  }
}

- (id<ComGoodowRealtimeCoreNet>)net {
  return net__;
}

- (void)scheduleDeferredWithComGoodowRealtimeCoreHandler:(id<ComGoodowRealtimeCoreHandler>)handler {
  [[NSRunLoop mainRunLoop] performSelector:@selector(handleWithId:) target:handler argument:nil order:0 modes:@[NSDefaultRunLoopMode]];
}

- (int)setPeriodicWithInt:(int)delayMs
withComGoodowRealtimeCoreHandler:(id<ComGoodowRealtimeCoreHandler>)handler {
  int id_ = [((JavaUtilConcurrentAtomicAtomicInteger *) nil_chk(timerId_)) getAndIncrement];
  (void) [((id<GDJsonObject>) nil_chk(timers_)) set:[NSString stringWithFormat:@"%d", id_] value:[self setPeriodicNativeWithInt:delayMs withComGoodowRealtimeCoreHandler:handler]];
  return id_;
}

- (ComGoodowRealtimeCorePlatform_TypeEnum *)type {
  return [ComGoodowRealtimeCorePlatform_TypeEnum IOS];
}

- (void)cancelTimerWithId:(id)timer {
  [(NSTimer *)timer invalidate];
}

- (id)setPeriodicNativeWithInt:(int)delayMs
withComGoodowRealtimeCoreHandler:(id<ComGoodowRealtimeCoreHandler>)handler {
  return
  [NSTimer scheduledTimerWithTimeInterval:delayMs/1000
  target:handler
  selector:@selector(handleWithId:)
  userInfo:nil
  repeats:YES];
}

- (id)init {
  if (self = [super init]) {
    timerId_ = [[JavaUtilConcurrentAtomicAtomicInteger alloc] initWithInt:1];
    timers_ = [GDJson createObject];
    net__ = [[ComGoodowRealtimeObjcObjCNet alloc] init];
  }
  return self;
}

- (void)copyAllFieldsTo:(ComGoodowRealtimeObjcObjCPlatform *)other {
  [super copyAllFieldsTo:other];
  other->net__ = net__;
  other->timerId_ = timerId_;
  other->timers_ = timers_;
}

+ (J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { "register__", "register", "V", 0x9, NULL },
    { "nativeHandleWithId:withId:", "nativeHandle", "V", 0x10a, NULL },
    { "cancelTimerWithInt:", "cancelTimer", "Z", 0x1, NULL },
    { "handleWithId:withId:", "handle", "V", 0x1, NULL },
    { "net", NULL, "Lcom.goodow.realtime.core.Net;", 0x1, NULL },
    { "scheduleDeferredWithComGoodowRealtimeCoreHandler:", "scheduleDeferred", "V", 0x101, NULL },
    { "setPeriodicWithInt:withComGoodowRealtimeCoreHandler:", "setPeriodic", "I", 0x1, NULL },
    { "type", NULL, "Lcom.goodow.realtime.core.Platform$Type;", 0x1, NULL },
    { "cancelTimerWithId:", "cancelTimer", "V", 0x102, NULL },
    { "setPeriodicNativeWithInt:withComGoodowRealtimeCoreHandler:", "setPeriodicNative", "Ljava.lang.Object;", 0x102, NULL },
    { "init", NULL, NULL, 0x0, NULL },
  };
  static J2ObjcFieldInfo fields[] = {
    { "timerId_", NULL, 0x12, "Ljava.util.concurrent.atomic.AtomicInteger;" },
    { "timers_", NULL, 0x12, "Lcom.goodow.realtime.json.JsonObject;" },
    { "net__", "net", 0x12, "Lcom.goodow.realtime.core.Net;" },
  };
  static J2ObjcClassInfo _ComGoodowRealtimeObjcObjCPlatform = { "ObjCPlatform", "com.goodow.realtime.objc", NULL, 0x0, 11, methods, 3, fields, 0, NULL};
  return &_ComGoodowRealtimeObjcObjCPlatform;
}

@end
